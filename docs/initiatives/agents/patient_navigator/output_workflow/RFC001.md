# RFC001: Output Communication Agent Workflow - Technical Design

## Context & Scope

This RFC defines the **MVP technical approach** for the Output Communication Agent Workflow. The core is a **simple communication agent** that takes structured agent outputs and makes them warm, clear, and user-friendly.

**MVP Requirements from PRD001.md:**
- Single communication agent that enhances response tone and clarity
- Basic consolidation of multiple agent outputs
- Simple workflow wrapper for future extensibility
- Focus on prompt engineering rather than complex architecture

**Success Metrics:**
- Warm, empathetic responses that users find helpful
- Clear, plain-language explanations of insurance concepts
- Working integration with existing agent workflows

---

## MVP Architecture

### Simple System Design

```
Agent Outputs → Communication Agent → Enhanced Response
```

**Core MVP Components:**
1. **Communication Agent**: LLM-based agent with specialized prompt for warm, empathetic responses
2. **Simple Workflow Wrapper**: Basic orchestration to call the agent and return results
3. **Input/Output Interfaces**: Standard data structures for integration

## Core MVP Implementation

### 1. Communication Agent

**Purpose**: LLM agent using Claude Haiku that transforms technical agent outputs into warm, empathetic responses

**Implementation Approach:**
```python
class CommunicationAgent(BaseAgent):
    def __init__(self, llm_client=None, **kwargs):
        super().__init__(
            name="output_communication",
            prompt="prompts/system_prompt.md",
            output_schema=CommunicationResponse,
            llm=llm_client,  # Claude Haiku client
            **kwargs
        )
    
    async def enhance_response(
        self, 
        agent_outputs: List[AgentOutput], 
        context: Dict[str, Any]
    ) -> CommunicationResponse:
        # Use BaseAgent pattern with specialized prompt
```

**Key Features:**
- **Inherits from BaseAgent** following established patterns
- **Claude Haiku LLM** for consistent performance and cost efficiency
- **Specialized system prompt** for warm, empathetic insurance communication
- **Input consolidation** from multiple agent outputs
- **Context awareness** for appropriate tone
- **Plain language transformation** through prompt instructions

### 2. Workflow Wrapper

**Purpose**: Simple orchestration layer for integration

```python
class OutputWorkflow:
    def __init__(self):
        self.communication_agent = CommunicationAgent(llm_client)
    
    async def process_request(
        self, 
        agent_outputs: List[AgentOutput]
    ) -> CommunicationResponse:
        # Basic validation, agent call, response formatting
```

### 3. Communication Prompt Design

**Core prompt elements:**
- **Role**: "You are a warm, empathetic insurance navigator assistant"
- **Tone guidelines**: Supportive, clear, emotionally aware
- **Content rules**: Plain language, actionable steps, appropriate sensitivity
- **Output format**: Structured, user-friendly responses

## Technical Decisions

### 1. BaseAgent Pattern with Claude Haiku

**Decision**: Use BaseAgent inheritance with Claude Haiku LLM rather than custom implementation

**Rationale:**
- **Consistency**: Follows established patterns in the codebase (information_retrieval agent)
- **Standardization**: Uses same BaseAgent infrastructure as other agents
- **Cost Efficiency**: Claude Haiku provides good performance at lower cost
- **Maintainability**: Leverages existing validation, error handling, and logging
- **Flexibility**: Natural language understanding handles varied content through prompts

### 2. Prompt Engineering Focus

**Decision**: Achieve communication goals through prompt design

**Rationale:**
- **MVP appropriate**: Get core functionality working quickly
- **Iterative improvement**: Easy to refine prompts based on testing
- **Proven approach**: Similar to existing agent patterns in codebase
- **Extensible**: Can add complex logic later if needed

### 3. Minimal Architecture

**Decision**: Simple workflow wrapper around communication agent

**Rationale:**
- **Focus on value**: Core feature is better communication, not architecture
- **Reduce complexity**: Fewer components = fewer failure points
- **Faster delivery**: Less code to write and test
- **Future flexibility**: Can elaborate architecture as needs become clear

## Actual Data Models (Compatible with Existing Workflows)

### Input Structure (From Existing Patient Navigator Workflows)

The communication agent accepts output models from all existing patient navigator workflows:

```python
# From Information Retrieval Agent (information_retrieval/models.py)
from agents.patient_navigator.information_retrieval.models import InformationRetrievalOutput

# From Strategy Creator Agent (strategy/creator/models.py)  
from agents.patient_navigator.strategy.creator.models import StrategyCreatorOutput

# From Regulatory Agent (strategy/regulatory/models.py)
from agents.patient_navigator.strategy.regulatory.models import RegulatoryAgentOutput

# From Supervisor Workflow (supervisor/models.py)
from agents.patient_navigator.supervisor.models import SupervisorWorkflowOutput

@dataclass
class CommunicationRequest:
    # Accept any of the existing workflow outputs
    workflow_outputs: List[Union[
        InformationRetrievalOutput,
        StrategyCreatorOutput, 
        RegulatoryAgentOutput,
        SupervisorWorkflowOutput
    ]]
    user_context: Optional[Dict[str, Any]] = None
    workflow_type: str  # Identifies which workflow type(s) are included
```

### Output Structure

```python
@dataclass
class CommunicationResponse:
    enhanced_content: str  # Main user-facing response
    original_sources: List[str]  # Track which workflows provided input
    processing_time: float
    metadata: Dict[str, Any]  # Processing info, confidence scores, etc.
```

## MVP Implementation Plan

### Single Phase Implementation (1-2 weeks)

**Week 1: Core Implementation**
- Create communication agent with specialized prompt
- Implement basic workflow wrapper
- Set up input/output data structures
- Create integration points with existing agent workflows

**Week 2: Testing & Refinement**
- Test with real agent outputs
- Refine communication prompt based on results
- Add error handling and basic monitoring
- Document usage and integration

**Success Criteria:**
- Working communication agent that improves response tone
- Integration with existing agent workflows
- Responses that feel warm and empathetic to users
- Clear, plain-language explanations of insurance concepts

## Performance Considerations

### MVP Performance Approach
- **LLM optimization**: Use efficient model and reasonable context limits
- **Simple caching**: Cache responses for identical inputs
- **Timeout handling**: Set reasonable timeouts for LLM calls
- **Error fallback**: Return original agent output if communication agent fails

### Scalability
- **Stateless design**: No session state in communication agent
- **Standard patterns**: Follow existing agent workflow patterns in codebase

## Risk Mitigation

### MVP Risks & Mitigations
- **LLM inconsistency**: Test thoroughly with diverse inputs, implement fallback to original content
- **Integration brittleness**: Use existing agent patterns, comprehensive error handling
- **Prompt drift**: Version control prompts, systematic testing of changes

## Testing Strategy

### Simple Testing Approach
- **Unit tests**: Basic workflow functionality and error handling
- **Integration tests**: End-to-end testing with sample agent outputs
- **Manual testing**: Human evaluation of response quality and tone
- **User feedback**: Collect feedback on warmth and clarity of responses

## Future Extensibility

### Easy Extensions
- **Prompt refinement**: Iterative improvement based on user feedback
- **Configuration options**: Add user preferences for communication style
- **Advanced features**: Add rule-based logic if prompt approach hits limits

## Next Steps

Following RFC approval:
1. **TODO001.md**: Simple implementation task breakdown for MVP communication agent
2. **Implementation**: Single phase development focusing on core communication agent
3. **Testing**: Validate response quality and user satisfaction with enhanced communication

## Key Assumptions

### MVP Assumptions to Validate
1. **LLM-based approach effective**: Specialized prompt can consistently produce warm, empathetic responses
2. **Simple consolidation sufficient**: Basic text combination of agent outputs meets user needs
3. **Integration feasible**: Can integrate with existing agent workflows without major changes
4. **User value clear**: Users prefer warm, clear responses over technical outputs

## Revision History

- **v1.0**: Initial RFC for MVP output communication agent workflow technical design
- **v1.1**: Simplified to focus on MVP approach with LLM-based communication agent