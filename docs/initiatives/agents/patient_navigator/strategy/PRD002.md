# PRD002: Strategy Evaluation & Validation System - MVP Simplification

## Document Context
This PRD002 replaces PRD001 based on refactor requirements from REFACTOR001.md. The system shifts from complex granular analysis to a high-level MVP implementation leveraging LLM-driven logic, prompt engineering, and simplified components.

**Reference Documents:**
- REFACTOR001.md - Refactor prescription for MVP simplification
- TODO001.md - Original implementation breakdown (for context)
- RFC001.md - Technical architecture (to be updated in RFC002)

## Problem Statement

Healthcare consumers and patient navigators need an efficient strategy generation system that can quickly provide actionable healthcare access strategies optimized for **speed, cost, and effort** rather than complex analytical approaches.

### Current Pain Points
- **Implementation Complexity**: The 001 system was too granular for MVP needs
- **Development Velocity**: Complex algorithms slow down iteration and maintenance
- **User Value Gap**: Over-engineered solutions delay delivery of core user value
- **Technical Debt**: Complex multi-provider integrations create maintenance burden

### Target Users
- **Healthcare Consumers**: Individuals seeking efficient healthcare access strategies
- **Patient Navigators**: Healthcare professionals assisting patients with care coordination
- **System Administrators**: Healthcare organizations managing strategy recommendations

## Success Metrics

### Primary KPIs
- **Strategy Generation Time**: < 30 seconds end-to-end
- **User Satisfaction**: > 80% find strategies actionable and relevant
- **Strategy Diversity**: 4 distinct optimization approaches per query
- **System Reliability**: 99% uptime with graceful degradation

### Secondary Metrics
- **Development Velocity**: 50% faster implementation vs complex approach
- **Maintenance Overhead**: < 10 hours/month for system maintenance
- **LLM Response Quality**: > 85% strategies pass regulatory validation
- **Cost Efficiency**: Reduced API costs through simplified web search

## User Stories

### Healthcare Consumer Stories
**As a healthcare consumer**, I want to receive 4 distinct strategy options (speed, cost, effort, balanced) so that I can choose the approach that best fits my current situation and priorities.

**As a healthcare consumer**, I want strategies generated in under 30 seconds so that I can get immediate guidance during urgent healthcare decisions.

**As a healthcare consumer**, I want strategies that consider my insurance constraints and geographic location so that the recommendations are actually actionable for my specific situation.

### Patient Navigator Stories
**As a patient navigator**, I want to help multiple clients simultaneously with reliable strategy generation so that I can provide efficient support during busy periods.

**As a patient navigator**, I want regulatory-validated strategies so that I can confidently recommend approaches that comply with healthcare regulations.

**As a patient navigator**, I want to provide feedback on strategy effectiveness so that the system improves over time based on real-world outcomes.

### Administrator Stories
**As a system administrator**, I want a maintainable system with clear logging so that I can quickly resolve issues and monitor performance.

**As a system administrator**, I want simplified integrations (Tavily-only web search) so that I have fewer external dependencies to manage and monitor.

## Functional Requirements

### Core Strategy Generation
- **FR001**: Generate exactly 4 strategies per request: speed-optimized, cost-optimized, effort-optimized, and balanced
- **FR002**: Use LLM-driven approach with prompt engineering rather than complex algorithms
- **FR003**: Optimize strategies based on plan constraints (copay, deductible, network providers, geographic scope, specialty access)
- **FR004**: Provide actionable steps and clear rationale for each strategy

### Context Gathering & Search
- **FR005**: Integrate Tavily API as single web search provider (replacing complex multi-provider approach)
- **FR006**: Perform semantic search of existing strategies using vector similarity
- **FR007**: Retrieve regulatory context from documents schema via semantic search
- **FR008**: Generate 3 web search queries per constraint set for optimization contexts

### Regulatory Validation
- **FR009**: Validate strategies using LLM-based compliance checking (simplified from ReAct pattern)
- **FR010**: Provide compliance status (approved/flagged/rejected) with reasoning
- **FR011**: Include confidence scores and source references for audit trail
- **FR012**: Trigger strategy storage only after successful validation

### Strategy Memory & Scoring
- **FR013**: Store strategies with dual scoring system: LLM scores (0.0-1.0) and human effectiveness scores (1.0-5.0)
- **FR014**: Update scoring schema from speed/cost/quality to speed/cost/effort
- **FR015**: Enable strategy retrieval through constraint-based filtering and vector similarity
- **FR016**: Support user feedback collection for strategy effectiveness

## Non-Functional Requirements

### Performance Requirements
- **NFR001**: End-to-end strategy generation < 30 seconds
- **NFR002**: Support 10 concurrent strategy generation requests
- **NFR003**: Database queries optimized for sub-100ms vector similarity search
- **NFR004**: Web search timeout limited to 5 seconds with graceful degradation

### Reliability & Availability
- **NFR005**: 99% system uptime with health monitoring
- **NFR006**: Graceful degradation when external services fail
- **NFR007**: Error handling with meaningful user messages
- **NFR008**: Comprehensive logging for debugging and monitoring

### Scalability & Maintainability
- **NFR009**: LLM-first architecture for easy prompt-based iteration
- **NFR010**: Simplified toolchain: Tavily + SentenceBERT + Supabase + LangGraph
- **NFR011**: Modular component design following BaseAgent patterns
- **NFR012**: Clear separation between context gathering, strategy generation, validation, and storage

### Security & Compliance
- **NFR013**: Row Level Security (RLS) for strategy data protection
- **NFR014**: Audit trail for all strategy generation and validation decisions
- **NFR015**: Secure API key management for external services
- **NFR016**: Data encryption in transit for sensitive healthcare information

## Acceptance Criteria

### Strategy Generation Acceptance
- **AC001**: System generates exactly 4 strategies with distinct optimization approaches
- **AC002**: Each strategy includes title, approach, rationale, and actionable steps
- **AC003**: LLM scoring provides speed/cost/effort scores (0.0-1.0 range) for each strategy
- **AC004**: Strategies are contextually relevant to provided plan constraints

### Integration Acceptance
- **AC005**: Tavily web search integration provides relevant context within 5-second timeout
- **AC006**: Vector similarity search returns relevant existing strategies
- **AC007**: Regulatory validation provides clear compliance status and reasoning
- **AC008**: Strategy storage succeeds with proper dual scoring fields

### Performance Acceptance
- **AC009**: Complete workflow executes in < 30 seconds for typical requests
- **AC010**: System handles 10 concurrent requests without degradation
- **AC011**: Database operations complete within performance thresholds
- **AC012**: Graceful degradation maintains basic functionality during service failures

### Quality Acceptance
- **AC013**: Generated strategies pass regulatory validation > 85% of the time
- **AC014**: User feedback collection and scoring updates function correctly
- **AC015**: System logging provides sufficient detail for debugging
- **AC016**: Error messages are user-friendly and actionable

## Assumptions & Dependencies

### Key Assumptions
- **A001**: Healthcare consumers prefer simpler, faster strategy generation over complex analysis
- **A002**: LLM reasoning provides sufficient quality for MVP healthcare strategy recommendations
- **A003**: Tavily API provides adequate search quality for context gathering
- **A004**: Existing pgvector and Supabase infrastructure supports required performance

### External Dependencies
- **D001**: Tavily API availability and response quality
- **D002**: OpenAI API for LLM generation and embeddings
- **D003**: Supabase database performance and reliability
- **D004**: Existing documents schema for regulatory context retrieval

### Internal Dependencies
- **D005**: BaseAgent infrastructure from existing patient_navigator patterns
- **D006**: Database migration capability for schema updates (quality → effort)
- **D007**: LangGraph workflow orchestration framework
- **D008**: SentenceBERT for text similarity when needed

## Scope Definition

### In Scope for MVP
- ✅ 4-strategy generation (speed, cost, effort, balanced)
- ✅ Tavily web search integration
- ✅ LLM-driven strategy generation via prompt engineering
- ✅ Simplified regulatory validation
- ✅ Dual scoring system with speed/cost/effort optimization
- ✅ Vector similarity search for existing strategies
- ✅ Basic user feedback collection

### Out of Scope for MVP
- ❌ Complex multi-provider web search fallback
- ❌ Detailed granular analysis algorithms
- ❌ Advanced ReAct pattern implementation
- ❌ Complex optimization mathematics
- ❌ Real-time strategy effectiveness tracking
- ❌ Advanced user interface components

### Future Considerations
- **Phase 2**: Enhanced user feedback analysis
- **Phase 2**: Advanced regulatory compliance features
- **Phase 2**: Integration with external healthcare systems
- **Phase 2**: Machine learning for strategy optimization

## Risk Assessment

### Technical Risks
- **R001**: LLM quality may vary for complex healthcare scenarios
  - *Mitigation*: Comprehensive prompt engineering and testing
- **R002**: Tavily API limitations or outages
  - *Mitigation*: Fallback to existing strategy search when web search fails
- **R003**: Database performance with vector operations
  - *Mitigation*: Proper indexing and query optimization

### Business Risks
- **R004**: MVP simplification may reduce strategy quality perception
  - *Mitigation*: Focus on speed and actionability as key user values
- **R005**: Regulatory compliance concerns with simplified validation
  - *Mitigation*: Maintain audit trail and enable human review processes

### Operational Risks
- **R006**: Increased LLM API costs with higher usage
  - *Mitigation*: Monitor usage patterns and optimize prompt efficiency
- **R007**: Learning curve for simplified architecture
  - *Mitigation*: Clear documentation and prompt engineering guidelines

## Next Steps

This PRD002 establishes the simplified MVP requirements for the Strategy Evaluation & Validation System. The next document, **RFC002.md**, will define the technical architecture implementing these requirements with:

- LLM-first architectural approach
- Simplified 4-component workflow (StrategyMCP → StrategyCreator → RegulatoryAgent → StrategyMemoryLite)
- Tavily integration and prompt engineering strategies
- Database schema updates for speed/cost/effort optimization
- Performance and scaling considerations for MVP deployment

The implementation will follow TODO002.md with streamlined development tasks focused on prompt engineering and simplified component integration rather than complex algorithmic development.