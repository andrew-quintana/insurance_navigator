# PRD001: Strategy Evaluation & Validation System (Web-First MVP)

## Document Context
This PRD defines the MVP phase for the patient navigator strategy agent workflow as outlined in ROADMAP001.md. It establishes the foundation for a real-time healthcare access strategy creation and validation system.

## Problem Statement

Healthcare consumers struggle to navigate complex insurance plan constraints (copays, deductibles, network access) when seeking optimal care strategies. Current solutions lack real-time validation against regulatory requirements and fail to provide personalized recommendations that balance speed, cost, and quality considerations.

**Key Pain Points:**
- Users cannot easily translate insurance plan metadata into actionable healthcare strategies
- No automated validation of strategy legality, feasibility, and ethical guidelines
- Lack of real-time web search integration for current healthcare provider information
- No systematic approach to optimize strategies based on user priorities (speed vs cost vs quality)

## Success Metrics

**Primary KPIs:**
- Strategy generation time: < 30 seconds from plan constraints input
- Regulatory validation accuracy: > 95% compliance rate
- User strategy acceptance rate: > 70% of generated strategies deemed actionable
- System uptime: 99% availability during business hours

**Secondary Metrics:**
- Web search query effectiveness: Relevant results in top 5 results > 80%
- Strategy diversity: Generate 3+ distinct approaches per user query
- Validation thoroughness: 100% of strategies checked against regulatory database

## User Stories

**Primary User: Healthcare Consumer**
- As a healthcare consumer, I want to input my insurance plan constraints so that I can receive optimized care strategies
- As a healthcare consumer, I want strategies validated for legal compliance so that I avoid regulatory issues
- As a healthcare consumer, I want to choose optimization priorities (speed/cost/quality) so that strategies match my preferences

**Secondary User: Healthcare Navigator/Agent**
- As a healthcare navigator, I want transparent strategy reasoning so that I can explain recommendations to clients
- As a healthcare navigator, I want regulatory validation logs so that I can ensure compliance documentation

## Functional Requirements

### Core Components

**1. StrategyMCP (Model Context Protocol Tool)**
- **Location**: `agents/tooling/mcp/strategy/`
- **Input**: Plan-specific constraints (copay, deductible, network access) from metadata table
- **Process**: Transform constraints into targeted web search queries
- **Output**: Structured search queries for healthcare provider/service lookup
- **Integration**: Read from existing plan metadata storage system
- **Pattern**: Follows `agents/tooling/rag/` architecture with core.py and tests/

**2. StrategyCreator Agent**
- **Location**: `agents/patient_navigator/strategy/creator/`
- **Input**: Retrieved web context from StrategyMCP queries
- **Process**: Generate 3+ distinct strategies optimizing for speed, cost, or quality
- **Output**: Structured strategy recommendations with rationale
- **Capabilities**: Multi-objective optimization, alternative pathway generation
- **Pattern**: Follows `agents/patient_navigator/information_retrieval/` architecture with agent.py, models.py, prompts/, tests/

**3. RegulatoryAgent (ReAct Pattern)**
- **Location**: `agents/patient_navigator/strategy/regulatory/`
- **Input**: Generated strategies from StrategyCreator
- **Process**: Validate against legal, feasibility, and ethical guidelines using RAG + live web access
- **Output**: Validation status with specific compliance notes
- **Data Sources**: Regulatory database (RAG) + real-time web verification
- **Pattern**: Follows `agents/patient_navigator/information_retrieval/` architecture with agent.py, models.py, prompts/, tests/

**4. StrategyMemoryLite Agent**
- **Location**: `agents/patient_navigator/strategy/memory/`
- **Input**: Validated strategies from RegulatoryAgent
- **Process**: Store and retrieve strategies using dual storage (metadata + vector)
- **Output**: Semantic retrieval results for StrategyMCP + storage confirmation
- **Data Sources**: Direct Supabase SDK integration with pgvector extension
- **Pattern**: Follows `agents/patient_navigator/information_retrieval/` architecture with agent.py, models.py, prompts/, tests/

### System Integration
- **Lightweight memory system** - dual storage with metadata table and vector store
- **Web-first approach** - real-time data retrieval with memory augmentation
- **LangGraph workflow orchestration** - orchestrated component execution
- **Architecture consistency** - follows established agent and tooling patterns

## Non-Functional Requirements

**Performance:**
- Response time: < 30 seconds end-to-end
- Concurrent users: Support 10 simultaneous strategy requests
- Web search timeout: 5 seconds per query with fallback handling

**Reliability:**
- Error handling: Graceful degradation if web sources unavailable
- Validation coverage: 100% strategy regulatory checking
- Fallback mechanisms: Default to conservative strategies if validation fails

**Security:**
- Plan data: Encrypt sensitive insurance information in transit
- Web access: Use secure HTTPS connections for all external queries
- Validation: Log all regulatory checks for audit trail

**Usability:**
- Strategy presentation: Clear, actionable language for non-technical users
- Validation transparency: Explain why strategies pass/fail regulatory checks
- Priority selection: Simple interface to choose speed/cost/quality optimization

## Acceptance Criteria

### StrategyMCP Tool (agents/tooling/mcp/strategy/)
- [ ] Successfully converts plan constraints (copay, deductible, network) into search queries
- [ ] Generates minimum 3 distinct query approaches per constraint set
- [ ] Integrates with existing metadata table without requiring schema changes
- [ ] Handles missing or incomplete plan data gracefully
- [ ] Follows established tooling patterns with core.py and comprehensive tests/

### StrategyCreator Agent (agents/patient_navigator/strategy/creator/)
- [ ] Produces 3+ unique strategies per user request
- [ ] Each strategy clearly optimizes for stated priority (speed/cost/quality)
- [ ] Includes rationale explaining strategy recommendation
- [ ] Formats output in structured, user-friendly format
- [ ] Follows established agent patterns with agent.py inheriting from BaseAgent, models.py, prompts/

### RegulatoryAgent (agents/patient_navigator/strategy/regulatory/)
- [ ] Validates 100% of generated strategies
- [ ] Provides specific compliance reasoning for each validation
- [ ] Accesses both RAG database and live web sources
- [ ] Flags strategies with regulatory concerns clearly
- [ ] Follows established agent patterns with ReAct methodology and comprehensive testing

### StrategyMemoryLite Agent (agents/patient_navigator/strategy/memory/)
- [ ] Stores validated strategies in dual storage system (metadata + vector)
- [ ] Retrieves relevant strategies using semantic similarity search
- [ ] Supports constraint-based filtering before vector search
- [ ] Integrates with Supabase SDK directly following established database patterns

### End-to-End Workflow (agents/patient_navigator/strategy/workflow/)
- [ ] Complete strategy generation + validation + memory storage in < 30 seconds
- [ ] LangGraph orchestration integrates all components seamlessly
- [ ] Handles concurrent requests without performance degradation
- [ ] Provides transparent logging of all decision points
- [ ] Gracefully handles external service failures with established error handling patterns

## Assumptions & Dependencies

**Assumptions:**
- Plan metadata table already exists and is populated
- Users have basic understanding of insurance terms (copay, deductible)
- Regulatory database (RAG) is accessible and current
- Web search APIs remain stable and accessible

**Dependencies:**
- **Critical**: Access to plan metadata storage system
- **Critical**: Regulatory database for RAG implementation
- **Critical**: Web search API access (Google, Bing, or similar)
- **Important**: Existing user authentication system
- **Important**: Healthcare provider directory APIs

**External Integrations:**
- Plan metadata table (read access)
- Web search services (API access)
- Regulatory database (query access)
- Healthcare provider directories (optional for enhanced results)

## Out of Scope for MVP

- **No persistent memory** - strategies not stored between sessions
- **No user personalization** - generic strategy generation
- **No feedback loops** - no learning from user interactions
- **No advanced orchestration** - no LangGraph or complex pipelines
- **No performance optimization** - basic implementation sufficient
- **No admin interfaces** - developer access only

## Risk Assessment

**High Risk:**
- Web search API rate limits could impact concurrent users
- Regulatory database accuracy affects validation quality
- Plan metadata quality directly impacts strategy relevance

**Medium Risk:**
- External service dependencies create failure points
- Strategy generation time may exceed 30-second target under load
- Regulatory validation complexity could introduce false positives

**Mitigation Strategies:**
- Implement circuit breakers for external service calls
- Cache regulatory queries to reduce lookup time
- Provide fallback strategies if real-time validation fails

## Next Steps

This PRD establishes the foundation for MVP implementation. The next document (RFC001.md) will detail the technical architecture, component interactions, and implementation approach for the Strategy Evaluation & Validation System.

**Immediate Actions:**
1. Stakeholder review and approval of requirements
2. Technical design phase (RFC001.md creation)
3. Development timeline and resource allocation
4. Integration planning with existing systems